# Виджет

## Описание:

Проект "Виджет" - это приложение для анализа банковских операций, которые находятся в Excel-файле.
Приложение генерирует JSON-данные для веб-страниц, формирует Excel-отчеты, а также предоставляет другие сервисы.

## Установка:

1. Клонируйте репозиторий
   ```
   git clone https://github.com/TimurAgeenko/course_project
   ```
2. Установите зависимостиЖ
   ```
   poetry install
   ```

## Использование:

1. Функция choose_greeting возвращает строку с приветствием, которая будет отличаться в зависимости от времени суток:
   ```
   Если пользователь делает запрос в диапазоне от 6:00 до 12:00, не включая крайнюю границу: 
   choose_greeting() вернет "Доброе утро"
   
   Если пользователь делает запрос в диапазоне от 12:00 до 18:00, не включая крайнюю границу: 
   choose_greeting() вернет "Добрый день"
   
   Если пользователь делает запрос в диапазоне от 18:00 до 00:00, не включая крайнюю границу: 
   choose_greeting() вернет "Добрый вечер"
   
   Если пользователь делает запрос в диапазоне от 00:00 до 6:00, не включая крайнюю границу: 
   choose_greeting() вернет "Доброй ночи"
   ```
   
2. Функция get_data принимает путь к файлу, содержащему информацию о транзакциях, в формате xlsx
   и возвращает список словарей с транзакциями:
   ```
   Для использования достаточно вызвать функцию с указанием пути до файла:
   data = get_data("../data/operations.xlsx")
   
   Если путь до файла не был указан, то по умолчанию будет считаться, что файл лежил в дирректории data в корне проекта
   ```
   
3. Функция sort_data_by_date принимает список словарей с транзакциями и дату в формате YYYY-MM-DD HH:MM:SS
   и возвращает отсортированный список словарей, где находятся транзакции с датой от начала месяца,
   на который выпадает указанная дата, до указанной даты:
   ```
   При вызове
   data = sort_data_by_date(data, "2021-09-15 18:00:00")
   
   Первая транзакция в получившемся списке словарей будет иметь дату "2021-09-15" и совершена до 18:00
   Все транзакции далее будут иметь такую же дату либо меньшую, пока список не дойдёт до транзакций с датой "2021-09-01"
   Крайние транзакции в списке будут иметь именно эту дату
   ```
   
4. Функция get_cards_info принимает список словарей с транзакциями и возвращает список словарей
   с использованными в транзакциях картами, в котором содержатся последние цифры карт,
   общая сумма потраченных денег и сумма кэшбэка:
   ```
   cards_info = get_cards_info(data)
   print(cards_info)
   
   Выдаст [
      {
        "last_digits": "5814",
        "total_spent": 1262.00,
        "cashback": 12.62
      },
      {
        "last_digits": "7512",
        "total_spent": 7.94,
        "cashback": 0.08
      }
   ]
   ```
   
5. Функция get_top_transactions принимает список словарей с транзакциями и возвращает список словарей
   с наибольшими по сумме транзакциями с информацией о дате операции, её сумме, категории и описании
   ```
   top_transactions = get_top_transactions(data)
   print(top_transactions)
   
   Выдаст [
     {
       "date": "21.12.2021",
       "amount": 1198.23,
       "category": "Переводы",
       "description": "Перевод Кредитная карта. ТП 10.2 RUR"
     },
     {
       "date": "20.12.2021",
       "amount": 829.00,
       "category": "Супермаркеты",
       "description": "Лента"
     },
     {
       "date": "20.12.2021",
       "amount": 421.00,
       "category": "Различные товары",
       "description": "Ozon.ru"
     },
     {
       "date": "16.12.2021",
       "amount": -14216.42,
       "category": "ЖКХ",
       "description": "ЖКУ Квартира"
     },
     {
       "date": "16.12.2021",
       "amount": 453.00,
       "category": "Бонусы",
       "description": "Кешбэк за обычные покупки"
     }
   ]
   ```
   
6. Функция get_currency_rates принимает на вход путь до файла с кодами валют и акций,
   заданными пользователем, который по умолчанию находится в корне проекта,
   и возвращает список словарей с кодом валюты и её стоимостью в рублях
   ```
   currency_rates = get_currency_rate()
   print(currency_rates)
   
   Если в файле user_settings.json в ключе "user_currencies" указано ["USD", "EUR"], то данный код выдаст:
   [{"currency": "USD", "rate": 80.5}, {"currency": "EUR", "rate": 90.2}]
   ```
   
7. Функция get_stock_prices принимает на вход путь до файла с кодами валют и акций,
   заданными пользователем, который по умолчанию находится в корне проекта,
   и возвращает список словарей с кодом валюты и её стоимостью в рублях
   ```
   stock_prices = get_stock_prices()
   print(stock_prices)
   
   Если в файле user_settings.json в ключе "user_stocks" указано ["AMZN"], то данный код выдаст:
   [{"stock": "AMZN", "rate": 19826.35}]
   ```

8. Функция main_views - это основная функция для реализации веб-страницы "Главная", которая принимает на вход строку
   с датой и временем в формате YYYY-MM-DD HH:MM:SS и возвращает JSON-ответ с приветствием, информацией по картам,
   топ-5 транзакциями, курсами валют и акций:
   ```
   json_response = main_views("2021-09-15 18:00:00")
   print(json_response)
   
   Выдаст {
     "greeting": "Добрый вечер",
     "cards_info": [...],
     "top_transactions": [...],
     "currency_rates": [...],
     "stock_prices": [...]
   }
   ```
   
9. Функция get_top_cashback_categories принимает на вход список словарей с транзакциями, год и месяц и возвращает
   JSON-строку с категориями, по которым был получен кэшбэк за указанный месяц и год, по убыванию:
   ```
   cashback_categories = get_top_cashback_categories(data, 2021, 12)
   print(cashback_categories)
   
    Выдаст [
      {"category": "Бонусы", "cashback": 45.30},
      {"category": "Супермаркеты", "cashback": 8.29},
      {"category": "Различные товары", "cashback": 4.21},
      ...
    ]
   ```
   
10. Функция spending_by_category генерирует отчет по тратам в указанной категории за последние три месяца от переданной даты.
    Дата должна быть в формате 'YYYY-MM-DD HH:MM:SS'. Если дата не указана, используется сегодняшняя дата:
    ```
    spending_report = spending_by_category(data, "Супермаркеты", "2021-12-31 23:59:59")
    print(spending_report)
    
    Выдаст Dataframe с отчетом по тратам в категории "Супермаркеты" за октябрь, ноябрь и декабрь 2021 года.
    ```
    
11. Декоратор log_to_file используется для логирования вызовов функции в указанный файл:
    ```
    @log_to_file("./logs/test_log.log")
    def add(a, b):
        return a + b

    add(1, 2)

    Содержимое файла ./logs/test_log.log будет следующим:
    
    Function 'add' was called.
    Arguments: [1, 2].
    Result:
    3
    ```
    
12. Функция main - это главная функция приложения, которая вызывает функции из других модулей
    и выводит результаты в консоль:
    ```
    Для использования достаточно вызвать функцию:
    main()
    ```
   
## Тестирование

Для запуска тестов выполните следующие шаги:

1. Убедитесь, что у вас установлен `pytest`
2. В терминале наберите `pytest`, чтобы запустить тестирование
3. Проверьте результаты в консоли

При тестировании используются юнит-тесты, их результаты выводятся в консоль.

Подробные отчеты о тестировании можно найти в директории `/htmlcov/` при вводе команды `pytest --cov=src --cov-report=html`